# GraphRAG 开发指南

# 开发前置

| 名称                 | 下载源                                                  | 组件用途                                |
|--------------------|------------------------------------------------------|-------------------------------------|
| Python 3.10 或 3.11 | [下载链接](https://www.python.org/downloads/)            | 本库基于Python                          |
| pipx               | python -m pip install --user pipx                    | pipx组件                              |
| Poetry             | [安装导引](https://python-poetry.org/docs/#installation) | Poetry将用于Python代码库中的包管理和virtualenv管理 |

**配置pipx:**<br>
Windows环境下通过命令行界面(CLI)来安装，请直接复制粘贴以下命令:
> py -m pip install --user pipx

- 若已经通过Microsoft Store安装Python，请复制粘贴以下命令：
> python -m pip install --user pipx

找到用户文件路径下，AppData中\Python3xx\Scripts路径，在此路径下以CLI运行命令：
> pipx.exe ensurepath

**配置poetry:**<br>
Windows环境下通过命令行界面(CLI)来安装，请直接复制粘贴以下命令：
> (Invoke-WebRequest -Uri https://install.python-poetry.org -UseBasicParsing).Content | py -

- 若已经通过Microsoft Store安装Python，请复制粘贴以下命令：
> (Invoke-WebRequest -Uri https://install.python-poetry.org -UseBasicParsing).Content | python -

# 快速开始

## 安装前置
进入Graphrag项目路径
```sh
# 安装前置依赖项，本安装过程需要依赖pyproject.toml配置文件，故须在Graphrag项目路径下进行：
poetry install
```

## 执行索引引擎

```sh
poetry run poe index <...args>
```

## Executing Queries

```sh
poetry run poe query <...args>
```

## Versioning

We use [semversioner](https://github.com/raulgomis/semversioner) to automate and enforce semantic versioning in the release process. Our CI/CD pipeline checks that all PR's include a json file generated by semversioner. When submitting a PR, please run:
```shell
poetry run semversioner add-change -t patch -d "<a small sentence describing changes made>."
```

# Azurite

Some unit and smoke tests use Azurite to emulate Azure resources. This can be started by running:

```sh
./scripts/start-azurite.sh
```

or by simply running `azurite` in the terminal if already installed globally. See the [Azurite documentation](https://learn.microsoft.com/en-us/azure/storage/common/storage-use-azurite) for more information about how to install and use Azurite.

# Lifecycle Scripts

Our Python package utilizes Poetry to manage dependencies and [poethepoet](https://pypi.org/project/poethepoet/) to manage custom build scripts.

Available scripts are:
- `poetry run poe index` - Run the Indexing CLI
- `poetry run poe query` - Run the Query CLI
- `poetry build` - This invokes `poetry build`, which will build a wheel file and other distributable artifacts.
- `poetry run poe test` - This will execute all tests.
- `poetry run poe test_unit` - This will execute unit tests.
- `poetry run poe test_integration` - This will execute integration tests.
- `poetry run poe test_smoke` - This will execute smoke tests.
- `poetry run poe check` - This will perform a suite of static checks across the package, including:
  - formatting
  - documentation formatting
  - linting
  - security patterns
  - type-checking
- `poetry run poe fix` - This will apply any available auto-fixes to the package. Usually this is just formatting fixes.
- `poetry run poe fix_unsafe` - This will apply any available auto-fixes to the package, including those that may be unsafe.
- `poetry run poe format` - Explicitly run the formatter across the package.

## Troubleshooting

### "RuntimeError: llvm-config failed executing, please point LLVM_CONFIG to the path for llvm-config" when running poetry install

Make sure llvm-9 and llvm-9-dev are installed:

`sudo apt-get install llvm-9 llvm-9-dev`

and then in your bashrc, add

`export LLVM_CONFIG=/usr/bin/llvm-config-9`

### "numba/\_pymodule.h:6:10: fatal error: Python.h: No such file or directory" when running poetry install

Make sure you have python3.10-dev installed or more generally `python<version>-dev`

`sudo apt-get install python3.10-dev`

### LLM call constantly exceeds TPM, RPM or time limits

`GRAPHRAG_LLM_THREAD_COUNT` and `GRAPHRAG_EMBEDDING_THREAD_COUNT` are both set to 50 by default. You can modify this values
to reduce concurrency. Please refer to the [Configuration Documents](https://microsoft.github.io/graphrag/posts/config/overview/)
